#!/bin/bash

indent() {
    sed -u 's/^/       /'
}

echo "-----> Found a .terraform_url file"

if [ ! -s $1/.terraform_url ]; then
    echo ".terraform_url empty. Skipping." | indent
    exit 0
fi

UNZIP_COMMAND="unzip"

if [ $STACK == "cedar" ]; then
  UNZIP_COMMAND="jar xf"
fi

while read url; do
  if [ -n "$url" ]; then
    mkdir -p "$1/bin"
    echo Vendoring $url | indent
    curl -L "$url" -o "$1/bin/terraform.zip"
    if [ $? -ne 0 ]; then
        >&2 echo "Couldn't download $url" 
        exit 1
    fi
    cd $1/bin && $UNZIP_COMMAND terraform.zip && rm terraform.zip
  fi
done < $1/.terraform_url
